
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>TDD: The Dog And The Fence - All Your Base Are Belong To Me</title>
  <meta name="author" content="Antoine Grondin">

  
  <meta name="description" content="You thought Test Driven Development: By Example (Kent Beck) was a biblical ouvrage perfectly illustrating how to apply TDD to your software practice &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://aybabt.me/blog/2013/02/09/tdd-the-dog-and-the-fence/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="All Your Base Are Belong To Me" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3281894-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">All Your Base Are Belong To Me</a></h1>
  
    <h2>Random ideas, code and rants.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:aybabt.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">TDD: The Dog and the Fence</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-09T21:22:00-05:00" pubdate data-updated="true">Feb 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>You thought <a href="http://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530">Test Driven Development: By Example</a> (Kent Beck) was a biblical ouvrage perfectly illustrating how to apply TDD to your software practice?  Think again! Today, I claim to have a <strong>better example</strong>.</p>

<h2>Say What?</h2>

<p>Since last Saturday, the usual maintainer of <code>the_house</code> is gone in vacation.  She&#8217;s been wandering around in the South of the US, lurking at Florida&#8217;s beaches.  Before flying out, she asked me to maintain her project and ensure that everything was running smoothly.  There&#8217;s not much to do, so it&#8217;s not really a problem.</p>

<p>Or so I thought!</p>

<p>When would be a better time for <code>the_house</code> to crash than when its maintainer is away?</p>

<!-- more -->


<h2>The Setting</h2>

<p>About two days ago, an area spanning at least the /16 block started to accumulate a lot of garbage (some collocated neighbours call it &#8220;snow&#8221;), with no clear means to evacuate it. As any decent person would do, I undertook the enterprise of manually moving much of that crap out of main memory and moving it to swap in front of <code>the_house</code>, out of the way and leaving room for <code>cars</code> and <code>pedestrians</code> to execute properly.</p>

<h3>First Sign Of Failure</h3>

<p>For a few hours, all was good.  Then two days ago, in the morning, a prescient sign of failure appeared.  The collocated admin of <code>another_house</code> sent me an e-mail, which he quite oddly printed and stamped on <code>the_house.door</code> (what a strange individual).  Apparently, two of our <code>dogs</code> had escaped from within our local network.</p>

<p>Here you might be wondering &#8220;what the hell are they doing with two <code>dogs</code>&#8221;.  It happens that the users of <code>the_house</code> enjoy the company of <code>dogs</code> so they maintain two of them within the boundaries (or so they thought!) of their localhost.  They do so against any common sense, every decent human being knowledgeably avoiding such annoying-ware for fear they will clutter their <code>house</code>
with garbages of all kind, or even destroy parts of <code>the_house</code>.</p>

<p>So although it&#8217;s entirely in their right to put their instance of <code>the_house</code> at risk like that, they have to ensure the <code>dogs</code> can&#8217;t make it out to the neighbour systems (and destroy their environment)!</p>

<p>While nothing of that happened on this specific occurrence, still, that morning, two <code>dogs</code> crossed the <code>fence</code> firewall.</p>

<p>At first, I thought it was a misconfigured setting.  I went about <code>fence</code> and discovered a benign leak caused by a parameter.  I fixed it with a simple hack; I found somewhere in <code>the_house.trash</code> a piece of scrap that could apparently block the leak.</p>

<blockquote><p>Easy-peasy!</p></blockquote>

<p>&#8230;did I think to myself!</p>

<blockquote><p>Those vile <code>dogs</code> won&#8217;t make it out anytime soon!</p></blockquote>

<p>Blah!  My lack of humility would take a little more than 12 hours to pay me back with a good dose of failure.</p>

<h3>Error, error, error!</h3>

<p>So that initial failure was maybe a little more complicated than a misconfigured dotfile.  As I logged back into <code>the_house</code> on that evening, I found the two <code>dogs</code> missing.  Apparently, they had yet again fled.  For some insane reason, the closest neighbour of our /24 block decided to take custody of the escaped <code>dogs</code> while waiting for the suppleant maintainer of <code>the house</code> (that is me) to come back.</p>

<p>Well well well, that was quite odd.  The scrap I had put in front of the leak was gone, and it was nowhere to be found around it (I suspect the two <code>kids</code> in the collocated <code>house</code> abused their rights on <code>fence</code> and purposely freed the scrap away from the leak in order to run their insatiable <code>play</code> program onto <code>dogs</code>).</p>

<p>Indeed, the problem was bigger than I thought.  There was a need to fix this <code>fence</code> or <code>the_house</code> could be put in jeopardy in this collocated server, pissing off the co-users of the box.</p>

<p>By now you might think that life is serving me a painful injection of wisdom, right into the brain.  Well you&#8217;re wrong.</p>

<h3>My Brain Is Harder Than Steel</h3>

<p>The next (this) morning, as I wake up and prepare to go take a shower, I find myself carelessly believing that <code>dogs</code> won&#8217;t find their way through the leak in a mere 15 minutes, while I wash and get them back inside.</p>

<p>And indeed, yet again they fled.  They escaped in all their glory, deciding this time to make an assault of the /16 block neighbours.  With a decent amount of shame, I find myself pinging all corners of the area, trying to find where the <code>dogs</code> are.  Luckily, they didn&#8217;t go <em>too</em> far and 15 minutes later, I brought them back home.</p>

<p>I put them to idle behind a virtual network we call <code>crate</code> and I leave for the day.  On the way to my destination, I fill in a bug report for <code>the_house</code> and mark it as confirmed.</p>

<h2>At Last, Common Sense Prevails</h2>

<h3>TL;DR:</h3>

<p>The dogs escaped the house three times before I realized (or accepted) that there was a real problem with the fence.  Also, I put my <em>TL;DR</em> in the middle of the damn text, just as pointless as it can be.  I saw that elsewhere and thought &#8220;that&#8217;s a pretty pointless location where to put a <em>TL;DR</em>&#8221;.  Now, you&#8217;ve been served as well!</p>

<blockquote><p>What a nice guy!</p></blockquote>

<h3>The Real Nature of the Beast</h3>

<p>It so happens that a massive amount of crap, so called <code>snow</code>, has elevated the levels of pressure on <code>fence</code>, making it prone to fail upon application of <code>dogs</code>&#8217; requests to traverse it.  In all usual circumstances, <code>fence</code> should have enough resources to hold the <code>dogs</code> at bay.  However, that extra <code>snow</code> has lowered the barrier of entry for the <code>dogs</code> to cross it.  On top of that, there&#8217;s that annoying blatant hole in <code>fence</code> which is not helping.</p>

<p>I really need to fix this bug, once and for all.  How can I do that? Like any fixer will tell you, the first step to take is to define a test case that confirms the presence of the bug.</p>

<p>In our case, what we need is:</p>

<ul>
<li>An instance of <code>dog</code>, preferably a resourceful, motivated and hyperactive dog. Cast it into an <code>overexcited_dog</code>.</li>
</ul>


<p><img src="/images/picture_of_lovelace.jpg" width="800" height="450" title="'A Resourceful, motivated and hyperactive dog (perhaps a bit evil too)'" ></p>

<ul>
<li>An insufficient <code>fence</code>, preferably misconfigured (that is, with &#8220;holes&#8221; in it).</li>
</ul>


<h3>The Test</h3>

<p>What kind of test can we use to highlight the failures of our <code>fence</code>?  It&#8217;s quite simple and it holds in three steps:</p>

<ol>
<li>Take the <code>overexcited_dog</code> and set it behind the <code>fence</code>.</li>
<li>Get on the other side of the <code>fence</code> with an array of <code>meat</code>.  The <code>overexcited_dog</code> must be aware of the presence of <code>meat</code> in the array.</li>
<li>Shake the array of <code>meat</code> until <code>overexcited_dog</code> be upcast into a <code>way_too_excited_dog</code>.</li>
</ol>


<p>The test fails if <code>way_too_excited_dog</code> gets across the <code>fence</code> and eats the array of <code>meat</code>.  If the <code>way_too_excited_dog</code> doesn&#8217;t make it through, it will be downcast into a <code>whining_dog</code>, which can be recognized by its near-panic state of despair.  It is important that you end the test <strong>immediately</strong> when the <code>dog</code> reaches this state, because it&#8217;s way too cruel otherwise.  To do so, just give an entry from <code>meat</code> to the <code>dog</code> and let it back into <code>the_house</code>, and everything shall be fine.</p>

<h2>Red, Green, Refactor</h2>

<p>We now have a failing test.  Indeed, when I run it, I invariably obtain a <code>way_too_excited_dog</code>, who eats my array of <code>meat</code>.</p>

<p>I can&#8217;t keep this test <em>red</em> for too long (I don&#8217;t have enough meat!), so I need to find a fix!</p>

<h3>First Try</h3>

<p>I go around <code>the_house</code> and find a metal shovel.  Maybe if I dig a trench around <code>fence</code>, my <code>overexcited_dog</code> won&#8217;t make it through (despite the hole)!</p>

<p>I run the test:</p>

<blockquote><p><strong>Red</strong>.</p></blockquote>

<p>Woah! What a pity!</p>

<h3>Second Try</h3>

<p>Taking a piece of <code>fence</code> covering a side of the wall from <code>the_house</code> and cutting it away from the rest, I then proceed to apply it upon the hole in the <code>fence</code>, effectively patching it.</p>

<p>I run the test:</p>

<blockquote><p><strong>Red</strong>.</p></blockquote>

<p>What?  Again?  Indeed, the <code>way_too_excited_dog</code> made it through in some unexpected way: it jumped over the <code>fence</code> altogether.</p>

<p>Despite the trench and the patched hole, we still have a red test!  Thanks to TDD, I can now see that the real nature of my bug is not only the hole in the wall, but the raw nature of the <code>fence</code>!</p>

<p>Luckily enough, the test I designed above is perfectly adapted to this scenario (since it brought it to our ear loud-and-clear).</p>

<p>I return to my tools and observe the <code>fence</code> once again.  The <code>way_too_excited_dog</code> managed to cross it by climbing on the bending <code>fence</code>.  Given enough <code>over_excitement</code>, the <code>dog</code> effectively uses the <code>fence</code> as a spring to propel itself higher up, jumping to meet the delicious <code>meat</code>. I grab a plank of wood from <code>the_house.basement</code> and bring it outside to apply it on the lowest side of the <code>fence</code>.</p>

<p>By stretching the wire of the chicken fence (oh yeah, I forgot to mention it <em>is</em> a chicken fence, hah!) and fixing it at the plank, and doing the same on the second half of the <code>fence</code> with a wooden stick that I find around, I manage to set the <code>fence</code> straight.</p>

<p>Then I run my test once again.</p>

<h3>Green!</h3>

<p>The <code>overexcited_dog</code> quickly transforms into <code>whining_dog</code>.  This (chicken) <code>fence</code> has overcome its resourcefulness, motivation and hyperactivity!</p>

<h3>Refactor!</h3>

<p>Now, this is the state of the <code>fence</code>:</p>

<p><img src="/images/weak_chicken_fence.jpg" width="800" height="450" title="'Quite A Weak Fence, Indeed'" ></p>

<p>It&#8217;s quite a weak fence if you ask me.  Although our test for <code>the_house.fence</code> is green, we&#8217;re left with really ugly hacks around.  We can&#8217;t let our codebase in this state!</p>

<p>Unfortunately, <code>fence</code> is too big an endeavour to undertake until the <code>Spring</code> release.  The whole thing will have to be rebuilt from scratch, using an actual, proper <code>fence</code> this time.  In the meantime, we&#8217;ll have to deal with this hack and keep an eye on our test - make sure it stays green!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Antoine Grondin</span></span>

      








  


<time datetime="2013-02-09T21:22:00-05:00" pubdate data-updated="true">Feb 9<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/hack/'>hack</a>, <a class='category' href='/blog/categories/life/'>life</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://aybabt.me/blog/2013/02/09/tdd-the-dog-and-the-fence/" data-via="AntoineGrondin" data-counturl="http://aybabt.me/blog/2013/02/09/tdd-the-dog-and-the-fence/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/01/12/simple-trick-to-enhance-security-using-google-chrome/" title="Previous Post: Simple Trick To Enhance Security Using Google Chrome">&laquo; Simple Trick To Enhance Security Using Google Chrome</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/02/27/interview-request-about-our-uottawa-coding-competition/" title="Next Post: Interview Request About Our uOttawa Coding Competition">Interview Request About Our uOttawa Coding Competition &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/02/27/interview-request-about-our-uottawa-coding-competition/">Interview Request About Our uOttawa Coding Competition</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/09/tdd-the-dog-and-the-fence/">TDD: The Dog And The Fence</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/12/simple-trick-to-enhance-security-using-google-chrome/">Simple Trick To Enhance Security Using Google Chrome</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/09/cusec-but-im-first-year/">CUSEC - But I'm First Year!</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/01/death-of-a-sandal/">Death of a Sandal</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/aybabtme">@aybabtme</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'aybabtme',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("AntoineGrondin", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/AntoineGrondin" class="twitter-follow-button" data-show-count="false">Follow @AntoineGrondin</a>
  
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/110571618805635475927?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Antoine Grondin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
